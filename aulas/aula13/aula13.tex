%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% talk: prototype
%%% 2002/10/16
%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%
%%% Erstellen eines Vortrags in PDF-Format wie folgt:
%%%
%%% 1) Uebersetzen der Datei mit 
%%%    pdflatex asz
%%% 2) Wenn Features von ppower4 gewuenscht werden, dann die eben
%%%    entstandene Datei asz.pdf weiterverarbeiten mit
%%%    ./ppower4 asz.pdf vortrag.pdf
%%% 3) Die Datei vortrag.pdf kann nun mit dem Acrobat Reader angesehen
%%%    werden
%%%
%%% Fuer Testzwecke ist auch ein "normales" Uebersetzen mit LaTeX
%%% moeglich:
%%% 1) latex asz
%%% 2) dvips asz.dvi -o asz.ps -t a4 -t landscape
%%% 3) Anschauen mit ghostview
%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifx\pdfoutput\undefined \documentclass[clock,landscape]{slides} \else
\documentclass[clock,landscape]{slides} \fi
%\documentclass[clock,pdftex,landscape]{slides} \fi
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Escrevendo em português:
\usepackage[brazil]{babel}
\usepackage[latin1]{inputenc} % isso é quase redundante
\usepackage{textcomp}
\usepackage[T1]{fontenc}
\usepackage{multirow}
\usepackage{graphicx}
\usepackage{epstopdf}
\usepackage{float}
\usepackage{tabularx}
 
\usepackage{clrscode}
\usepackage{algorithm}
\usepackage{multicol}

\usepackage{psfrag}


\usepackage{tikz}
\usetikzlibrary{tikzmark}
\usepackage{pgf}

%----------------------------
\usepackage{tabularx}
%%% Die Datei mit dem ASZ-Layout

\usepackage{shi}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{amsmath,amssymb,amsthm} \usepackage{amsfonts}
\usepackage[colorlinks,backref]{hyperref}
%\usepackage{background}

%\usepackage{picinpar}

\hypersetup{pdftitle={Arquiteturas paralelas e distribuídas},
  pdfsubject={Algoritmos paralelos}, 
  pdfauthor={Leonardo Takuno, Centro Universitário SENAC, 
  <leonardo.takuno@gmail.com>},
  pdfkeywords={acrobat, ppower4},
%  pdfpagemode={FullScreen},
  colorlinks={false},
  linkcolor={red}
}

\usepackage{color}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% Pauseneffekte mit ppower4 werden moeglich

\usepackage{pause}
\newcommand\plone{\pause\pauselevel{=1}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newtheoremstyle{mythm}% name
  {40pt}%      Space above
  {-15pt}%      Space below
  {\sf\itshape\blue}%      Body font
  {}%         Indent amount (empty = no indent, \parindent = para indent)
  {\sf\bfseries\green}% Thm head \vspacefont
  {.}%        Punctuation after thm head
  { }%     Space after thm head: " " = normal interword space;
        %       \newline = linebreak
  {}%         Thm head spec (can be left empty, meaning `normal')

\theoremstyle{mythm}
\newtheorem{theorem}             {Theorem}       
\newtheorem{claim}     [theorem] {Claim}         
\newtheorem{lemma}     [theorem] {Lemma}         
\newtheorem{corollary} [theorem] {Corollary}     
\newtheorem{fact}      [theorem] {Fact}          
\newtheorem{conjecture}[theorem] {Conjecture}    
\newtheorem{problem}   [theorem] {Problem}       

\newtheorem{propriedade}  [theorem] {Propriedade}       
\newtheorem{corolario}  [theorem] {Corolário}       
\newtheorem{teorema}  [theorem] {Teorema}       
\newtheorem{definicao}  [theorem] {Definição}       

%%% Symbole

\newcommand{\NN}{\mathbb{N}} \newcommand{\RR}{\mathbb{R}}
\newcommand{\ZZ}{\mathbb{Z}} \newcommand{\1}{{{\mathchoice {\rm
        1\mskip-4mu l} {\rm 1\mskip-4mu l} {\rm 1\mskip-4.5mu l} {\rm
        1\mskip-5mu l}}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\let\phi\varphi
\let\epsilon\varepsilon
\let\rho\varrho
\let\tilde\widetilde
\let\approx\thickapprox
\let\sim\thicksim

\def\({\left(}
\def\){\right)}
\def\[{\left[}
\def\]{\right]}
\def\<{\langle}
\def\>{\rangle}
\let\:\colon
\def\llfloor{\left\lfloor}
\def\rrfloor{\right\rfloor}
\def\llceil{\left\lceil}
\def\rrceil{\right\rceil}

%%% Textmakros
\def\ex{\mathop{\text{\rm ex}}\nolimits} 
\def\cB{{\mathcal B}} 
\def\cG{{\mathcal G}}
\def\cS{{\mathcal S}} 
\def\cW{{\mathcal W}} 
\def\cQ{{\mathcal Q}} 
\def\PP{{\mathbb P}}
\def\EE{{\mathbb E}} 
\def\GG{{\mathbb G}} 
\def\e{{\rm e}}
\def\epsilon{{\varepsilon}} 
\def\DISC{\mathop{\textrm{\rm DISC}}\nolimits} 
\def\EIG{\mathop{\textrm{\rm EIG}}\nolimits}
\def\CIRCUIT{\mathop{\textrm{\rm CIRCUIT}}\nolimits}
\def\CYCLE{\mathop{\textrm{\rm CYCLE}}\nolimits}
\def\SUB{\mathop{\textrm{\rm SUB}}\nolimits}
\def\NSUB{\mathop{\textrm{\rm NSUB}}\nolimits}
\def\PAIR{\mathop{\textrm{\rm PAIR}}\nolimits}
\def\TFNSUB{\mathop{\textrm{\rm TFNSUB}}\nolimits}
\def\BDD{\mathop{\textrm{\rm BDD}}\nolimits}
\def\eps{\varepsilon}

\def\rmd{\text{\rm d}}
\def\wtc{\widetilde{c}\,}
\def\whc{\widehat{c}}
\def\bfb{{\bf b}}
\def\bff{{\bf f}}
\def\bft{{\bf t}}
\def\bfx{{\bf x}}
\def\bfz{{\bf z}}
\def\cB{{\mathcal B}}
\def\cD{{\mathcal D}}
\def\cG{{\mathcal G}}
\def\cM{{\mathcal M}}
\def\cN{{\mathcal N}}
\def\cR{{\mathcal R}}
\def\cS{{\mathcal S}}
\def\cW{{\mathcal W}}
\def\PP{{\mathbb P}}
\def\EE{{\mathbb E}}
\def\FF{{\mathbb F}}
\def\NN{{\mathbb N}}
\def\RR{{\mathbb R}}
\def\ZZ{{\mathbb Z}}
\def\e{{\rm e}}
\def\card{\mathop{\text{\rm card}}\nolimits}
\def\rank{\mathop{\text{\rm rank}}\nolimits}
\def\trace{\mathop{\text{\rm trace}}\nolimits}
\def\Ave{\mathop{\text{\rm Ave}}\nolimits}
\def\Bi{\mathop{\text{\rm Bi}}\nolimits}
\def\im{\mathop{\text{\rm im}}\nolimits}
\def\ind{\mathop{\text{\rm ind}}\nolimits}
\def\dist{\mathop{\text{\rm dist}}\nolimits}
\def\nDist{\mathop{\text{\rm \#Dist}}\nolimits}
\let\Dist\nDist
\def\De{D_{\rm e}}
\def\sumL{\sum\nolimits_1}
\def\sumS{\sum\nolimits_2}
\def\GF{\mathop{\text{\rm GF}}\nolimits}
\let\FF\GF
\def\Bip{\mathop{\text{\rm Bip}}\nolimits}
\def\adj{\mathop{\text{\rm adj}}\nolimits}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\nx}{{\hfill\vspace*{-2cm}\tiny +}}

%\newcommand{\red}[1]{\textcolor{red}{#1}}
%\newcommand{\blue}[1]{\textcolor{blue}{#1}}
%\newcommand{\yellow}[1]{\textcolor{yellow}{#1}}
%\newcommand{\green}[1]{\textcolor{green}{#1}}
%\newcommand{\darkgreen}[1]{\textcolor{darkgreen}{#1}}
\def\red{\color[rgb]{0.7,0,0}}
\def\green{\color[rgb]{0,.8,0}}
\def\darkgreen{\color[rgb]{0.1,0.4,0.0}}
\let\dgreen\darkgreen
\def\blue{\color[rgb]{0,0,.8}}
\def\yellow{\color[rgb]{1,1,0}}
\def\black{\color[rgb]{0,0,0}}

\def\pink{\color[rgb]{1,0,1}}
\def\brown{\color[rgb]{.5,.1,.3}}
\def\lilaz{\color[rgb]{.5,0,.5}}
\def\hmmm{\color[rgb]{.3,.1,.5}}
\def\magenta{\color[rgb]{.6,.05,.05}}

\newcommand{\uc}[1]{\centerline{\underline{#1}}}
\newcommand{\pic}[1]{\fbox{picture:{#1}}}
%\renewcommand{\bf}{\mbox{}}
\newcommand{\cP}{{\cal P}} \newcommand{\cT}{{\cal T}}
\newcommand{\add}{\mbox{\rm add}} \newcommand{\pr}{\mbox{\rm Pr}}

\def\stitle#1{\slidetitle{\red #1}\vspace{-0pt}}

\def\itemtrig{$\vartriangleright$}
\def\itemcirc{$\circ$}
\def\itemT{\item[\itemtrig]}
\def\itemC{\item[$\circ$]}

\everymath={\blue}
\everydisplay={\blue}

\renewcommand{\For}{\textbf{\blue para} }
\renewcommand{\To}{\textbf{\blue até} }
\renewcommand{\By}{\textbf{by} }
\renewcommand{\Downto}{\textbf{downto} }
\renewcommand{\While}{\textbf{\blue enquanto} }
\renewcommand{\Repeat}{\textbf{\blue repita}\>\>\addtocounter{indent}{1}}
\renewcommand{\Until}{\kill\addtocounter{indent}{-1}\liprint\>\>\textbf{until}\hspace*{-0.7em}\'}
\renewcommand{\If}{\textbf{\blue se} }
\renewcommand{\Then}{\textbf{\blue então}\>\addtocounter{indent}{1}}
\renewcommand{\Else}{\kill\addtocounter{indent}{-1}\liprint\textbf{\blue senão}\>\addtocounter{indent}{1}}
\renewcommand{\End}{\addtocounter{indent}{-1}}
\renewcommand{\ElseIf}{\kill\addtocounter{indent}{-1}\liprint\textbf{\blue senão se} }
\renewcommand{\ElseNoIf}{\kill\addtocounter{indent}{-1}\liprint\textbf{else} \addtocounter{indent}{1}}
\renewcommand{\Do}{\>\>\textbf{\blue faça}\hspace*{-0.7em}\'\addtocounter{indent}{1}}
\renewcommand{\Return}{\textbf{\blue devolva} }
\renewcommand{\Comment}{$\hspace*{-0.075em}\rhd$ }
\renewcommand{\RComment}{\`\Comment}
\renewcommand{\Goto}{\textbf{goto} }
\renewcommand{\Error}{\textbf{error} } % optionally followed by string argument
\newcommand{\DoPar}{\textbf{\blue faça em paralelo}\addtocounter{indent}{1}}
\newcommand{\DoSeq}{\textbf{\blue faça}\addtocounter{indent}{1}}
\newcommand{\Senao}{\kill\addtocounter{indent}{-1}\textbf{\blue senão}\addtocounter{indent}{1}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%Anuschs Extras
%
%\def\enddiscard{}
%\long\def\discard#1\enddiscard{}
%
%%%\vpagecolor{bgblue}
%\hypersetup{pdfpagetransition=Dissolve}
%\hypersetup{pdfpagetransition=R}
%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% Farben kann man hier definieren

\definecolor{bgblue}{rgb}{0.04,0.39,0.53}

\definecolor{darkyellow}{rgb}{0.94,0.820,0.058}
\definecolor{orange}{rgb}{0.95,0.47,0.14}
\definecolor{darkgreen}{rgb}{0.0,0.5,0.0}

\definecolor{blue2}{rgb}{0.1,0.39,0.53}
\definecolor{yellow1}{rgb}{1,1,0} \definecolor{pink}{rgb}{1,0,1}

\definecolor{lightred}{rgb}{1,0.5,0.5}
\definecolor{lightred2}{rgb}{1,0.7,0.7}
\definecolor{lightred3}{rgb}{1,0.3,0.3}
\definecolor{black}{rgb}{0,0,0} \definecolor{gray1}{rgb}{0.9,0.9,0.9}
\definecolor{red1}{rgb}{1,1,0.9}

\title{Arquitetura paralela e distribuída} 
\author{{\blue L.~Takuno} (SENAC)}
\date{{\dgreen 1o. Semestre 2017}}

%%% Hier beginnt die Praesentation

\begin{document}\def\proofname{{\bf\green Prova.}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Deckblatt
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\maketitle

%\slidesubhead{}  %% Teilvortrags-Titel (hier noch nicht)
                 %% Dieser erscheint spaeter oben links unter
                 %% dem ASZ Gesamt-Titel

%%%%%%%%%%%%%%%%%%%%%%% TOC %%%%%%%%%%%%%%%%%%

%\slidesubhead{Outline!!!}
\begin{slide}
  \stitle{Fontes principais}
  \begin{enumerate}\makeatletter\itemsep\z@\makeatother
  \item E. Cáceres, H. Mongeli, S. Song: Algoritmos paralelos u\-san\-do CGM/PVM/MPI: uma introdução\\
    \verb|http://www.ime.usp.br/~song/papers/jai01.pdf| 
     \item N. A. Lynch: Distributed Algorithms, Morgan Kaufmann Publishers, Inc., 96
   \begin{itemize}
    \itemT Algoritmos distribuídos
    \end{itemize}
  \end{enumerate}
\end{slide}

 
 
\begin{slide}
  \stitle{Sistemas distribuídos}
\end{slide}

\begin{slide}
  \stitle{Sistemas distribuídos}

Coleção de entidades independentes (nós) que cooperam entre si, através de comunicação, para resolver um problema que não pode ser resolvido individualmente por cada nó.
\end{slide}

\begin{slide}
  \stitle{Sistemas distribuídos}
  Um sistema distribuído existe sempre que houver comunicação entre nós autônomos (agentes inteligentes) e geograficamente distribuídos
  \begin{center}
\includegraphics[height=8cm]{fig01}
\end{center}
\end{slide}

\begin{slide}
  \stitle{Características de Sistemas distribuídos}
  \begin{itemize}
  \itemT Ausência de um relógio global;
  \vspace{-1cm} \itemT Ausência de memória compartilhada;
  \vspace{-1cm} \itemT Separação geográfica e incerteza em tempos de comunicação e processamento;
  \vspace{-1cm} \itemT Possibilidade de falhas independentes de nós e da rede; e
  \vspace{-1cm} \itemT Dificuldade (impossibilidade) de conhecer o estado global do sistema.
  \end{itemize}
\end{slide}

\begin{slide}
  \stitle{Algoritmos distribuídos}

 \begin{itemize}
  \itemT  Algoritmos distribuídos são programas que executam em nós de uma rede (com atrasos e confiabilidade não conhecidos). 
  \itemT É composto por processos que conjuntamente e de forma coordenada, realizam uma tarefa e precisam manter a consistência.
 \end{itemize}
\end{slide}

\begin{slide}
  \stitle{Premissas desejáveis}
  O que esperamos de um algoritmo?
\begin{itemize}
\itemT Estar correto
\vspace{-1cm} \itemT Ter baixa complexidade
\end{itemize}  

   Em algoritmos distribuídos tudo depende do ambiente de execução
   
\begin{itemize}
\itemT Grau de sincronismo
\vspace{-1cm} \itemT Garantia de entrega de mensagens
\vspace{-1cm} \itemT Possibilidade de falhas (nós e redes)
\end{itemize} 
\end{slide}


\begin{slide}
  \stitle{Comunicação entre processos (interprocessos)} 
  $P_i$ é um processo que:
  \begin{itemize}
\itemT Encapsula um estado (variáveis com valores)
\vspace{-1cm} \itemT Reage a eventos externos
\vspace{-1cm} \itemT Interage através de envio de mensagens
\end{itemize}
\end{slide}

\begin{slide}
  \stitle{Sincronização de sistemas distribuídos}  
\end{slide}

\begin{slide}
  \stitle{Sincronização de sistemas distribuídos}  
Tempo lógico

\begin{itemize}
\itemT Em um processo, os eventos são ordenados pelo tempo do relógio local
\vspace{-1cm} \itemT Não é possível sincronizar os relógios físicos perfeitamente, logo não tem como utilizá-los para determinar a ordem de ocorrência de 2 eventos em um sistema distribuído.
\end{itemize}
\end{slide}

\begin{slide}
  \stitle{Sincronização de sistemas distribuídos}  
  Solução para o problema:
  
  \begin{itemize}
\itemT  Utilizar um esquema baseado em \textbf{causalidade} (\textit{happened before} = ``aconteceu antes'')
\vspace{-1cm} \itemT $a \rightarrow b$, se e somente se, $a$ ocorre antes de $b$
\vspace{-1cm} \itemT Invés de sincronizar os relógios físicos ordenamos os eventos
\end{itemize}
\end{slide}

\begin{slide}
  \stitle{Sincronização de sistemas distribuídos} 
  \begin{center}
\includegraphics[height=4cm]{fig02}
\end{center}

$a \rightarrow b$ (em $P_1$)\\
$c \rightarrow d$ (em $P_2$)\\
$b \rightarrow c$ por causa de $m_1$\\
$d \rightarrow f$ por causa de $m_2$\\
$a//e$ eventos concorrentes
\end{slide}

\begin{slide}
  \stitle{Sincronização de sistemas distribuídos} 
Duas situações:

\begin{enumerate}
\item[(1)] Se os eventos $e_1$ e $e_2$ acontecem no mesmo processo, então $e_1 \rightarrow e_2$ (ordem observada entre os processos);
\item[(2)] Quando o processo envia uma mensagem $m$ para outro processo, o $envia()$ acontece antes do $recebe()$ ($envia(m) \rightarrow recebe(m)$.
\end{enumerate}    
Note que a relação $\rightarrow$ é transitiva.
\end{slide}

\begin{slide}
  \stitle{O relógio lógico de Lamport (1978)}
\begin{itemize}
\item   Mecanismo numérico para capturar e representar a relação $\rightarrow$ (acontece antes);
\item Cada processo $P_i$ tem um relógio lógico (contador) designado por $L_i$;
\item Não está ligado a um relógio físico.
\end{itemize} 
\end{slide}

\begin{slide}
  \stitle{O relógio lógico de Lamport (1978)}
  \textit{Timestamp} (marcas de tempo) são colocados nos eventos de acordo com as regras.
\begin{itemize}
\item Evento local: $L_i$ é incrementado antes de colocá-lo como timestamp em um evento
\item $envia$: Quando $P_i$ envia $m$, ele copia em $m$ o valor do seu $L_i$
\item $recebe$: Quando $P_i$ recebe uma mensagem $m$ com timestamp $t$, ele efetua o cálculo $L_j = max \{L_j, t\} + 1$ 
\end{itemize}  
\end{slide}

\begin{slide}
  \begin{center}
\includegraphics[height=7cm]{fig03}
\end{center}

  \stitle{Exemplo}
\begin{itemize}
  \item $L_1, L_2$ e $L_3$ são inicializados com 0 (zero)
 \vspace{-1cm} \item No envio de $m_1$, $P_1$ manda junto $L_1 = 2$
  \vspace{-1cm} \item $P_2$ recebe $m_1$ e calcula $L_2 = max\{0,2\} + 1$
\end{itemize}    
\end{slide}

\begin{slide}
  \stitle{Exclusão mútua}
\end{slide}

\begin{slide}
  \stitle{Exclusão mútua}
Problema: recursos não podem ser usados simultaneamente por vários processos

Solução: garantir exclusividade de acesso (exclusão mútua)
\end{slide}

\begin{slide}
  \stitle{Exclusão mútua}

 Regiões críticas
\begin{itemize}
\item Concorrência
\vspace{-1cm}\item Consistência
\end{itemize}
  Semáforos: Sistemas monoprocessados ou com multiprocessados com memória compartilhada.
 
\end{slide}

\begin{slide}
  \stitle{Exclusão mútua}
  \begin{itemize}
\vspace{-1cm}\item Sistemas distribuídos?

Resposta: semáforos distribuídos

\begin{itemize}
\item Centralizado
\vspace{-1cm}\item Descentralizado (Não veremos) - pouco eficiente
\vspace{-1cm}\item Distribuído
\vspace{-1cm}\item Anel
\end{itemize}

\end{itemize}
\end{slide}

\begin{slide}
  \stitle{Algoritmo centralizado}
  
  Similar a um sistema monoprocessado
  
  Um dos processos é eleito coordenador
  
  O coordenador garante a exclusão mútua
  
  Três tipos de mensagem 
  
  \begin{itemize}
  \vspace{-1cm}  \item Request (requisição)
  
  \vspace{-1cm} \item Reply (conceder)
  
  \vspace{-1cm} \item Release (Liberação)
  \end{itemize}
  
  \end{slide}

\begin{slide}
  \stitle{Algoritmo centralizado}
  \begin{center}
\includegraphics[height=12cm]{fig04}
\end{center}
\end{slide}

\begin{slide}
  \stitle{Algoritmo distribuído}
  Não existe coordenador e decisões são tomadas em grupo
  
  Proposta de Ricarte Agrawala é uma melhoria de idéias de Lamport
  
  
  Tal solução exige ordenação global dos eventos do sistema (\textit{timestamp})  
\end{slide}

\begin{slide}
  \stitle{Procedimento}
  Se um processo $i$ deseja entrar em uma Região Crítica x ($RCx$) ele gera um \textit{Timestamp} (TS) e envia $Request(i, RCx, TS)$.
  
  O processo $i$ saberá que $RCx$ está livre se receber \textit{Reply} de todos os outros processos.
\end{slide}

\begin{slide}
  \stitle{Algoritmo distribuído}
  Quando um processo recebe \textit{Request}
  \begin{itemize}
  \item Se não estiver acessando a $RCx$ e não quiser acessá-la devolve OK (Reply)
  \item Se ele estiver acessando a $RCx$ não responde e coloca o Request em uma fila de espera
  \item Se ele também deseja acessar a $RCx$, mantém uma fila de espera e envia o Reply (OK) para o Request com menor $TS$
  \end{itemize}
  \end{slide}

\begin{slide}
  \stitle{Algoritmo distribuído}
  Exemplo:
    \begin{center}
\includegraphics[height=8cm]{fig05}
\end{center}
  Processos 0 e 2 querem acessar um recurso ao mesmo ``tempo''
  
  8 e 12 são timestamps dos requests.
\end{slide}

\begin{slide}
  \stitle{Algoritmo distribuído}
  Acessa o recurso (Região crítica)
    \begin{center}
\includegraphics[height=6cm]{fig06}
\end{center}
  Processos 1 não tem interesse no recurso e envia OK para 0 e 2
  
  0 e 2 percebem o conflito, mas vence quem tem o menor timestamp.
  
\end{slide}

\begin{slide}
  \stitle{Algoritmo distribuído}
 
\begin{center}
\includegraphics[height=6cm]{fig07}
\end{center}
  Quando o processo 0 liberar o recurso ele envia OK para o processo 2 que estava na fila de espera.
  \end{slide}

\begin{slide}
  \stitle{Algoritmo em anel}
  Conhecido como Token Ring
  
  Processos pertence a um anel lógico
  
  Quem possui o token (ficha) é o que tem direito a acessar a região crítica.
  \end{slide}

\begin{slide}
  \stitle{Algoritmo em anel}
\begin{tabular}{l|l}

Algoritmo & Problema \\ \hline
Centralizado & Queda do coordenador \\
Distribuído & Queda de qualquer processo \\
Anel & Perda do token ou queda de um processo\\
\end{tabular}  
\end{slide}

\begin{slide}
  \stitle{Algoritmo em anel}
  \begin{center}
\includegraphics[height=6cm]{fig08}
\end{center}
Quando o anel é inicializado o processo 0 recebe o token
\end{slide}

\begin{slide}
  \stitle{Algoritmo de eleição}
\end{slide}

\begin{slide}
  \stitle{Algoritmo de eleição}
  Necessidade de um coordenador em ambiente distribuído
  
  A solução geral consiste em eleger o processo com maior ID
  
  Todos os processos precisam concordar com a eleição    
\end{slide}

\begin{slide}
  \stitle{Algoritmo do valentão}
\end{slide}

\begin{slide}
  \stitle{Algoritmo do valentão}
Desenvolvido por Garcia-Molina (1982)

Quando um processo percebe que o coordenador não está respondendo requisições, ele inicia uma nova eleição.

Convocações de eleição

\vspace{-1cm}\hspace{1cm}\itemtrig\ P envia mensagem de eleição para todos os 

\vspace{-1cm}\hspace{2cm}processos com IDs maiores.
\end{slide}

\begin{slide}
  \stitle{Algoritmo do valentão}
Eleições

\vspace{-1cm}\hspace{1cm}\itemtrig\ Se ninguém responde, P vence a eleição e torna-se 

\vspace{-1cm}\hspace{2cm}coordenador.

\vspace{-1cm}\hspace{1cm}\itemtrig\ Se algum processo com id maior responde, ele desiste.
  
Quando um processo recebe mensagem de eleição 

\vspace{-1cm}\hspace{1cm}\itemtrig\ Se o ID recebido é menor que o dele, envia OK para o remetente para indicar que está vivo e assume a coordenação.
\end{slide}

\begin{slide}
  \stitle{Algoritmo do valentão}
Todos os processos desistem, menos o que tiver maior ID.

Se o processo que estava indisponível voltar é iniciada uma nova eleição.
\end{slide}

\begin{slide}
  \stitle{Algoritmo do valentão}

\begin{center}
\begin{tikzpicture}
\node[circle, draw](n1) at (8, 11) {1}; 
\node[circle, draw](n5) at (11,10) {5}; 
\node[circle, draw](n2) at (5,10) {2}; 

\node[circle, draw](n4) at (4,8) {4}; 
\node[circle, draw](n6) at (12,8) {6};
\node[circle, draw](n0) at (5,6) {0}; 
\node[circle, draw](n3) at (11,6) {3}; 
\node[circle, draw](n7) at (8,5) {7}; 

\draw[thick][->](n4) -- node[above]{\tiny{eleição}} (n5);
\draw[thick][->](n4) -- node[above]{\tiny{eleição}} (n6);
\draw[thick][->](n4) -- node[above]{\tiny{eleição}} (n7);
\draw[thin] (7,4) -- (9,6);
\end{tikzpicture}
\end{center}

Processo 7 caiu.

\end{slide}

\begin{slide}
  \stitle{Algoritmo do valentão}

\begin{center}
\begin{tikzpicture}
\node[circle, draw](n1) at (8, 11) {1}; 
\node[circle, draw](n5) at (11,10) {5}; 
\node[circle, draw](n2) at (5,10) {2}; 

\node[circle, draw](n4) at (4,8) {4}; 
\node[circle, draw](n6) at (12,8) {6};
\node[circle, draw](n0) at (5,6) {0}; 
\node[circle, draw](n3) at (11,6) {3}; 
\node[circle, draw](n7) at (8,5) {7}; 

\draw[thick][->](n4) -- node[above]{\tiny{eleição}} (n5);
\draw[thick][->](n4) -- node[above]{\tiny{eleição}} (n6);
\draw[thick][->](n4) -- node[above]{\tiny{eleição}} (n7);
\draw[thin] (7,4) -- (9,6);
\end{tikzpicture}
\end{center}

Processo 4 percebeu e convocou nova eleição
\end{slide}

\begin{slide}
  \stitle{Algoritmo do valentão}

\begin{center}
\begin{tikzpicture}
\node[circle, draw](n1) at (8, 11) {1}; 
\node[circle, draw](n5) at (11,10) {5}; 
\node[circle, draw](n2) at (5,10) {2}; 

\node[circle, draw](n4) at (4,8) {4}; 
\node[circle, draw](n6) at (12,8) {6};
\node[circle, draw](n0) at (5,6) {0}; 
\node[circle, draw](n3) at (11,6) {3}; 
\node[circle, draw](n7) at (8,5) {7}; 

\draw[thick][<-](n4) -- node[above]{\tiny{OK}} (n5);
\draw[thick][<-](n4) -- node[above]{\tiny{OK}} (n6);

\draw[thin] (7,4) -- (9,6);
\end{tikzpicture}
\end{center}

Processos 5 e 6 respondem OK para o processo 4 que desiste.
\end{slide}

\begin{slide}
  \stitle{Algoritmo do valentão}

\begin{center}
\begin{tikzpicture}
\node[circle, draw](n1) at (8, 11) {1}; 
\node[circle, draw](n5) at (11,10) {5}; 
\node[circle, draw](n2) at (5,10) {2}; 

\node[circle, draw](n4) at (4,8) {4}; 
\node[circle, draw](n6) at (12,8) {6};
\node[circle, draw](n0) at (5,6) {0}; 
\node[circle, draw](n3) at (11,6) {3}; 
\node[circle, draw](n7) at (8,5) {7}; 

\draw[thick][<-](n6) -- node[right]{\tiny{eleição}} (n5);
\draw[thick][<-](n7) -- node[left]{\tiny{eleição}} (n5);
\draw[thick][<-](n7) -- node[above]{\tiny{eleição}} (n6);

\draw[thin] (7,4) -- (9,6);
\end{tikzpicture}
\end{center}

Processos 5 e 6 continuam a eleição.
\end{slide}

\begin{slide}
  \stitle{Algoritmo do valentão}

\begin{center}
\begin{tikzpicture}
\node[circle, draw](n1) at (8, 11) {1}; 
\node[circle, draw](n5) at (11,10) {5}; 
\node[circle, draw](n2) at (5,10) {2}; 

\node[circle, draw](n4) at (4,8) {4}; 
\node[circle, draw](n6) at (12,8) {6};
\node[circle, draw](n0) at (5,6) {0}; 
\node[circle, draw](n3) at (11,6) {3}; 
\node[circle, draw](n7) at (8,5) {7}; 

\draw[thick][->](n6) -- node[right]{\tiny{OK}} (n5);

\draw[thin] (7,4) -- (9,6);
\end{tikzpicture}
\end{center}

Processos 6 envia OK para o processo 5 que desiste.
\end{slide}

\begin{slide}
  \stitle{Algoritmo do valentão}

\begin{center}
\begin{tikzpicture}
\node[circle, draw](n1) at (8, 11) {1}; 
\node[circle, draw](n5) at (11,10) {5}; 
\node[circle, draw](n2) at (5,10) {2}; 

\node[circle, draw](n4) at (4,8) {4}; 
\node[circle, draw](n6) at (12,8) {6};
\node[circle, draw](n0) at (5,6) {0}; 
\node[circle, draw](n3) at (11,6) {3}; 
\node[circle, draw](n7) at (8,5) {7}; 

\draw[thick][->](n6) -- node[right] {} (n0);
\draw[thick][->](n6) -- node[right] {} (n1);
\draw[thick][->](n6) -- node[above]{\tiny{Coordenador}} (n4);
\draw[thick][->](n6) -- node[right] {} (n2);
\draw[thick][->](n6) -- node[right] {} (n3);
\draw[thick][->](n6) -- node[right] {} (n5);

\draw[thin] (7,4) -- (9,6);
\end{tikzpicture}
\end{center}

Processos 6 avisa aos demais processos que ele é o novo líder.
\end{slide}

\begin{slide}
  \stitle{Algoritmo em anel}
\end{slide}

\begin{slide}
  \stitle{Algoritmo em anel}
  
  Não utiliza token
  
  Processos fisicamente ou logicamente ordenados - cada processo reconhece seu sucessor
  
  Quando um processo percebe que o coordenador caiu ele inicia uma eleição.
\end{slide}

\begin{slide}
  \stitle{Algoritmo em anel}
O processo envia mensagem de eleição para o sucessor, com seu ID.

Se o sucessor está indisponível, envia para o próximo, e assim sucessivamente.

A cada passo, o processo que recebe a mensagem adiciona seu ID e repassa para o sucessor.   
\end{slide}

\begin{slide}
  \stitle{Algoritmo em anel}
  
  A mensagem deve retornar para quem iniciou a eleição.
  
  Quem enviou reconhece a mensagem por conter o seu ID.
  
  Decide quem deve ser o coordenador pelo maior ID.
  
  Avisa com uma nova rodada quem é o novo coordenador.
\end{slide}

\begin{slide}
  \stitle{Algoritmo em anel - Exemplo}
  
\begin{center}
\begin{tikzpicture}
\node[circle, draw](n1) at (8, 11) {1}; 
\node[circle, draw](n2) at (11,10) {2}; 
\node[circle, draw](n0) at (5,10) {0}; 

\node[circle, draw](n7) at (3,8) {7}; 
\node[circle, draw](n3) at (12,8) {3};
\node[circle, draw](n6) at (5,6) {6}; 
\node[circle, draw](n4) at (11,6) {4}; 
\node[circle, draw](n5) at (8,5) {5}; 

\draw[thick][->](n6) -- node[right] {\tiny{[5,6]}} (n0);
\draw[thick][->](n0) -- node[above] {\tiny{[5,6,0]}} (n1);
\draw[thick][->](n2) -- node[right]{\tiny{[2]}} (n3);
\draw[thick][->](n3) -- node[right] {\tiny{[2,3]}} (n4);
\draw[thick][->](n5) -- node[below] {\tiny{[5]}} (n6);

\draw[thin] (2,7) -- (4,9);
\end{tikzpicture}

Processo (coordenador) 7 caiu, 2 e 5 percebem e iniciam eleição "simultaneamente", no final o 6 é o novo coordenador.
\end{center}
\end{slide}

\begin{slide}
  \stitle{Tolerância a falhas}
\end{slide}

\begin{slide}
  \stitle{Tolerância a falhas}
  
\textbf{Tolerância a falhas:} propriedade que permite que sistemas continuem operando adequadamente após falha.

\textbf{Resiliência:} conceito físico, mas adotado no contexto computacional, pode ser entendido como a capacidade de adaptação ou recuperação de um sistema.
\end{slide}

\begin{slide}
  \stitle{Tolerância a falhas}
\textbf{Falha:} Quando o componente de um sistema deixa de se comportar conforme a especificação correta.

\textbf{Erro:} Causa de falha.
\end{slide}

\begin{slide}
  \stitle{Problema dos Generais Bizantinos}
\end{slide}

\begin{slide}
  \stitle{Problema dos Generais Bizantinos}
\begin{center}
\includegraphics[width=.5\textwidth]{fig09}
\end{center}
\end{slide}

\begin{slide}
  \stitle{Problema dos Generais Bizantinos}
  Generais binzantinos sitiam uma cidade 
  
\vspace{-1cm}\hspace{1cm}\itemtrig\ alguns generais são traidores
  
\vspace{-1cm}\hspace{1cm}\itemtrig\ mas devem chegar no concenso de atacar ou recuar.
  
\vspace{-1cm}\hspace{1cm}\itemtrig\ generais traidores não podem/devem atrapalhar o concenso.

Concordância bizantina: consenso na presença de falhas arbitrárias.
\end{slide}

\begin{slide}
  \stitle{Problema dos Generais Bizantinos}
Meta:

Conseguir o consenso entre todos os nós sem defeitos (nós não traidores)

\vspace{-1cm}\hspace{1cm}\itemtrig\ generais não traidores devem tomar a mesma decisão (atacar ou recuar)

\vspace{-1cm}\hspace{1cm}\itemtrig\ generais traidores podem enviar mensagem diferentes para generais diferentes.
\end{slide}

\begin{slide}
  \stitle{Exemplo com 3 Generais Bizantinos}
\begin{center}
\begin{tikzpicture}
\node[circle, draw](n0) at (8, 11) {0}; 
\node[above] at (8,11.5){\tiny{general}};
\node[circle, draw](n1) at (11,7) {1}; 
\node[right] at (11.6,7){\tiny{traidor}};
\node[circle, draw](n2) at (5,7) {2}; 
\draw[thick][->](n0) -- node[right] {\tiny{atacar}} (n1);
\draw[thick][->](n0) -- node[left] {\tiny{atacar}} (n2);
\draw[thick][->](n1) -- node[below] {\tiny{recuar}} (n2);
\end{tikzpicture}
\end{center}
\end{slide}

\begin{slide}
  \stitle{Exemplo com 3 Generais Bizantinos}
\begin{center}
\begin{tikzpicture}
\node[circle, draw](n0) at (8, 11) {0}; 
\node[above] at (8,11.5){\tiny{general traídor}};
\node[circle, draw](n1) at (11,7) {1}; 
\node[circle, draw](n2) at (5,7) {2}; 
\draw[thick][->](n0) -- node[right] {\tiny{recuar}} (n1);
\draw[thick][->](n0) -- node[left] {\tiny{atacar}} (n2);
\draw[thick][->](n1) -- node[below] {\tiny{recuar}} (n2);
\end{tikzpicture}
\end{center}
Problema insolúvel, o nó 2 não consegue distinguir uma situação da outra.
\end{slide}

\begin{slide}
  \stitle{Problema dos Generais Bizantinos}

Lamport, Shostak e Pease (1982)

\hspace{1cm}\itemtrig\ Dados $n$ processos (generais), pode ser tolerado até $m$ generais traidores sendo que $n \geq 3m+1$.

\hspace{2cm}Exemplo: $4$ processos podem tolerar até $1$ processo traidor.
\end{slide}

\begin{slide}
  \stitle{Problema com 4 Generais Bizantinos}
\begin{center}
\begin{tikzpicture}
\node[circle, draw](n0) at (5, 11) {0}; 
\node[circle, draw](n1) at (11,11) {1}; 
\node[circle, draw](n2) at (11,7) {2}; 
\node[right] at (11.6,7){\tiny{traidor}};

\node[circle, draw](n3) at (5,7) {3}; 
\draw[thick][->](n0) -- node[above] {\tiny{atacar}} (n1);
\draw[thick][->](n0) -- node[right] {\tiny{atacar}} (n2);
\draw[thick][->](n0) -- node[left] {\tiny{atacar}} (n3);
\end{tikzpicture}
\end{center}
  
\end{slide}

\begin{slide}
  \stitle{Problema com 4 Generais Bizantinos}
\begin{center}
\begin{tikzpicture}
\node[circle, draw](n0) at (5, 11) {0}; 
\node[circle, draw](n1) at (11,11) {1}; 
\node[circle, draw](n2) at (11,7) {2}; 
\node[right] at (11.6,7){\tiny{traidor}};
\node[circle, draw](n3) at (5,7) {3}; 

\draw[->] (n1) .. controls (7,9.9) .. node[above] {\tiny{atacar}} (n3);
\draw[thick][->](n3) -- node[above] {\tiny{atacar}} (n1);

\draw[thick][->](n2) -- node[above] {\tiny{atacar}} (n3);
\draw[thick, blue][->](n2) -- node[left] {\tiny{recuar}} (n1);

\draw[->] (n3) .. controls (8,6) .. node[below] {\tiny{atacar}} (n2);
\draw[->] (n1) .. controls (12,9) .. node[right] {\tiny{atacar}} (n2);
\end{tikzpicture}
\end{center}
  
  0,1 e 3 decidem atacar (consenso)
  
  Note que estamos considerando um sistema síncrono (timeout)
\end{slide}

\begin{slide}
  \stitle{Problema dos Generais Bizantinos}
O que acontece em um cenário com 9 generais, onde 1 general traidor envia 4 mensagens de atacar para 4 generais e 4 mensagens de recuar para os outros 4 generais?
  
\end{slide}

\begin{slide}
  \stitle{Problema dos Generais Bizantinos}
E se fossem 6 mensagens de atacar e 2 de recuar?

Considere também o caso com 5 mensagens de recuar e 3 de atacar.  
\end{slide}

\begin{slide}
  \stitle{Problema dos Generais Bizantinos}
  Diversos algoritmos foram propostos para tratar o problema da concordância bizantina.
  
\begin{teorema}
Se $2/3+1$ dos generais não são traidores, então existe uma solução (algoritmo) que resulta em uma ação comum que independe das mensagens enviadas pelos traidores.
\end{teorema}
\end{slide}

\begin{slide}
  \stitle{Problema dos Generais Bizantinos} 
\begin{teorema}
Se $1/3$ ou mais dos generais são traidores, então não existe uma solução para o problema.
\end{teorema}
\end{slide}

\begin{slide}
  \stitle{Exercício}
  Implemente um programa com MPI que trate/resolva o problema dos generais bizantinos.   
\end{slide}

\begin{slide}
  \stitle{Fim}
\end{slide}
\end{document}
